---
layout: layouts/base.njk
---
<style>
	/* Hide global header/footer in admin */
	header, footer {
		display: none !important;
	}

	/* Admin Shell Layout */
	.admin-shell {
		display: grid;
		grid-template-columns: 240px 1fr;
		height: 100vh;
		overflow: hidden;
		background: white;
	}

	/* Hide admin UI until permissions check completes */
	.admin-shell[data-hidden="true"] {
		visibility: hidden;
	}

	.admin-gate {
		position: fixed;
		inset: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		background: white;
		z-index: 9999;
		font-family: var(--font-family-ui);
		color: var(--color-text-muted);
	}

	/* Col 1: Admin Navigation */
	.admin-nav {
		background: #f9f9f9;
		border-right: 1px solid var(--color-border);
		padding: 1.5rem 1rem;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
	}

	.nav-group {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
	}

	.admin-nav-item {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.5rem 0.75rem;
		color: var(--color-text-muted);
		text-decoration: none;
		font-family: var(--font-family-ui);
		font-size: 0.875rem;
		font-weight: 500;
		border-radius: 6px;
		transition: all 0.2s;
	}

	.admin-nav-item:hover {
		background: rgba(0, 0, 0, 0.05);
		color: var(--color-text-main);
	}

	.admin-nav-item.active {
		background: #000;
		color: white;
	}
	
	.nav-icon {
		font-size: 1rem;
		width: 1.25rem;
		text-align: center;
	}

	.admin-nav-label {
		text-transform: uppercase;
		font-size: 0.75rem;
		letter-spacing: 0.05em;
		color: var(--color-text-muted);
		padding: 0 0.75rem;
		margin-top: 1.5rem;
		margin-bottom: 0.5rem;
		font-weight: 600;
	}

	/* Main Content Area */
	.admin-content {
		background: white;
		display: flex;
		flex-direction: column;
		overflow: hidden; /* Prevent scrolling on body */
		position: relative;
	}
	
	.admin-content-scroll {
		flex: 1;
		overflow-y: auto;
		height: 100%;
	}

	/* Reset container styles for admin layout to allow full width */
	#main .container {
		max-width: 100% !important;
		padding: 0 !important;
		margin: 0 !important;
	}
	
	/* Sidebar Profile */
	.sidebar-profile {
		border-top: 1px solid var(--color-border);
		padding-top: 1rem;
		margin-top: 1rem;
	}
</style>

<div class="admin-gate" data-admin-gate>Checking permissions‚Ä¶</div>
<div class="admin-shell" data-hidden="true" data-admin-shell>
	<nav class="admin-nav">
		<div class="nav-group">
			<div style="padding: 0 0.75rem 1rem;">
				<span style="font-weight: 700; font-family: var(--font-family-headings);">Admin</span>
			</div>
			
			<a href="/" class="admin-nav-item">
				<span class="nav-icon">‚Üê</span> Back to Site
			</a>
			
			<a href="/admin/" class="admin-nav-item {% if page.url == '/admin/' %}active{% endif %}">
				<span class="nav-icon">üè†</span> Home
			</a>
			
			<div class="admin-nav-label">Content</div>
			<a href="/admin/editor/" class="admin-nav-item {% if page.url == '/admin/editor/' %}active{% endif %}">
				<span class="nav-icon">üìù</span> Writing
			</a>
			<a href="/admin/music/" class="admin-nav-item {% if page.url == '/admin/music/' %}active{% endif %}">
				<span class="nav-icon">üéµ</span> Music
			</a>
			<a href="/admin/drafts/" class="admin-nav-item {% if page.url == '/admin/drafts/' %}active{% endif %}">
				<span class="nav-icon">üìã</span> Drafts
			</a>
			
			<a href="/admin/settings/" class="admin-nav-item {% if page.url == '/admin/settings/' %}active{% endif %}" style="margin-top: 1rem;">
				<span class="nav-icon">‚öôÔ∏è</span> Settings
			</a>
		</div>
		
		<div class="sidebar-profile">
			{% enhance %}
				<auth-status mode="sidebar-icon"></auth-status>
			{% endenhance %}
		</div>
	</nav>

	<div class="admin-content">
		<div class="admin-content-scroll">
			{{ content | safe }}
		</div>
	</div>
</div>

<script type="module">
  import { requireAdminOrRedirect } from '/shared/instant.mjs';

  const shell = document.querySelector('[data-admin-shell]');
  const gate = document.querySelector('[data-admin-gate]');

  // Gate all admin routes using server-enforced permissions (no email globals).
  const ok = await requireAdminOrRedirect('/admin/login/');
  if (ok) {
    if (gate) gate.remove();
    if (shell) shell.dataset.hidden = 'false';
  }
</script>
